# 📚 04월 29일 SQL 수업 정리

## ✏️ 목차

- [1. SQL 기본 및 중급 문법](#1-sql-기본-및-중급-문법)
- [2. 쿼리문 작성 및 실행 순서](#2-쿼리문-작성-및-실행-순서)
- [3. 실습 코드](#3-실습-코드)
- [4. Null (결측 데이터) 처리](#4-null-결측-데이터-처리)
- [5. 에러 경험 및 정리 ("큰따옴표" 오류)](#5-에러-경험-및-정리)

---

## 1. SQL 기본 및 중급 문법

- `SELECT`
- `DISTINCT`
- `WHERE` (AND, OR, NOT)
- `ORDER BY`
- `LIMIT`
- `BETWEEN AND`
- `IN` (카테고리 매칭)
- `LIKE` + 문자열 패턴
- 칼럼명 별칭 지정 (`AS`)
- 집계 함수
  - `AVG`, `SUM`, `MAX`, `MIN`, `COUNT`
  - → 집계 함수는 NULL을 무시한다.
  - → 전체 행 개수: `COUNT(*)`
- `GROUP BY`, `HAVING`

---

## 2. 쿼리문 작성 및 실행 순서

🔎 **SQL 실행 순서**

| 순서 | 구문     | 설명                                                         |
| :--- | :------- | :----------------------------------------------------------- |
| 1    | FROM     | 먼저 테이블을 선택한다                                       |
| 1'   | WHERE    | 조건을 걸어 레코드를 필터링한다 (NOT > AND > OR 순으로 평가) |
| 2    | GROUP BY | 조건에 맞는 그룹을 만든다                                    |
| 2'   | HAVING   | 그룹에 조건을 건다                                           |
| 3    | SELECT   | 원하는 컬럼을 추출한다                                       |
| 4    | ORDER BY | 정렬한다                                                     |
| 5    | LIMIT    | 개수를 제한한다                                              |

---

## 3. 실습 코드

### 3.1 `world_tb.sql`

```sql
-- 아시아/유럽 국가 중 인구 1천만 이상
SELECT code, name, continent, region, population
FROM country
WHERE (continent = 'Asia' OR continent = 'Europe')
AND population >= 10000000;

-- BETWEEN
SELECT * FROM country
WHERE population BETWEEN 1000000 AND 1100000;

-- IN (카테고리)
SELECT * FROM country
WHERE continent IN ('Asia', 'Africa', 'Europe')
ORDER BY continent;

-- LIKE
SELECT * FROM country
WHERE name LIKE 'A%';

SELECT * FROM country
WHERE name LIKE 'A_____';

-- population 비교
SELECT * FROM country
WHERE population != 100000;

-- 집계 함수
SELECT AVG(population), COUNT(population)
FROM city;

-- HAVING
SELECT continent, region, AVG(population) as population_avg
FROM country
WHERE name LIKE 'A%'
GROUP BY continent, region;

SELECT continent, region, AVG(population) as population_avg
FROM country
GROUP BY continent, region
HAVING AVG(population) >= 2000000;

-- 실행 순서
SELECT population AS popl, capital
FROM country
ORDER BY popl;

-- NULL 조회
SELECT *
FROM city
WHERE population IS NULL;
```

---

### 3.2 `employee_tb.sql`

```sql
SELECT * FROM titles;

SELECT * FROM employees
WHERE first_name = 'Parto' AND gender = 'M'
OR birth_date >= '1960-01-01';

-- 3글자 first_name + 성이 A 또는 B로 시작
SELECT * FROM employees
WHERE first_name LIKE '___' AND (last_name LIKE 'A%' OR last_name LIKE 'B%');

-- 부서별 직원 수
SELECT dept_no, COUNT(*)
FROM dept_emp
GROUP BY dept_no;

-- 전체 salary 조회
SELECT * FROM salaries;

-- 직원별 평균 급여
SELECT emp_no, AVG(salary) AS avg_salary
FROM salaries
GROUP BY emp_no
HAVING AVG(salary) >= 80000
ORDER BY avg_salary DESC;
```

---

### 3.3 `store_tb.sql`

```sql
-- 복합 조건 검색
SELECT *
FROM customers
WHERE (age < 30 OR (income >= 50000 AND age >= 50))
AND gender = 'M';

-- 특정 고객의 주문
SELECT * FROM orders;

SELECT *
FROM orders
WHERE customerid IN (7888, 1082, 12808, 9623)
ORDER BY orderdate;

-- firstname이 A로 시작 + 5글자 이상 + 특정 state
SELECT *
FROM customers
WHERE firstname LIKE 'A%'
  AND CHAR_LENGTH(firstname) >= 5
  AND state IN ('NY', 'PA')
ORDER BY age ASC;

-- 상품 카테고리별 개수
SELECT category AS cg, COUNT(*)
FROM products
WHERE price >= 20
GROUP BY category
HAVING AVG(price) >= 25
ORDER BY cg;
```

---

## 4. Null (결측 데이터) 처리

- `COALESCE`를 사용해서 NULL을 다른 값으로 대체할 수 있다.

```sql
-- NULL을 0으로 채우기
SELECT name, COALESCE(indepyear, 0)
FROM country;

-- NULL을 population 값으로 채우기
SELECT name, COALESCE(indepyear, population)
FROM country;
```

---

## 5. 에러 경험 및 정리

### ERROR: column "Parto" does not exist

**문제 상황:**

```sql
WHERE first_name="Parto" AND gender="M";
```

**에러 메시지:**

- `SQL state: 42703`
- `"Parto"`는 컬럼명으로 인식되어 에러 발생

---

### 해결 방법

- PostgreSQL에서는 **문자열 값**은 작은따옴표 `' '`로 감싸야 한다.
- **큰따옴표 `" "`**는 컬럼명, 테이블명 같은 **식별자**를 감쌀 때만 사용한다.

**수정된 코드:**

```sql
WHERE first_name = 'Parto' AND gender = 'M';
```

---

### 정리 표

| 구분            | 따옴표 | 용도                                  |
| :-------------- | :----- | :------------------------------------ |
| 문자열 값       | `' '`  | 데이터 비교                           |
| 컬럼명/테이블명 | `" "`  | 식별자 구분 (특수문자, 대소문자 유지) |

---

> ✅ PostgreSQL에서는 특별한 경우 아니면 큰따옴표 안 써도 된다.

---

# 🔥 마무리

- **문자열 패턴 매칭**: `%`, `_` 사용
- **집계 시 NULL 주의**: `AVG`, `COUNT` 등은 NULL을 무시한다.
- **쿼리 작성 순서**: FROM → WHERE → GROUP BY → HAVING → SELECT → ORDER BY → LIMIT
- **에러 발생시 원인 정확히 분석**: 문자열 vs 식별자 구분 중요!
